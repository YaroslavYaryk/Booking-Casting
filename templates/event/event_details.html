{% extends 'base/auth_base.html' %}
{% load static %}
{% load widget_tweaks %}
{% load artist_tags %}

{% block link %}
  <link href=" {% static 'falcon2/public/vendors/swiper/swiper-bundle.min.css'  %} " rel="stylesheet" />
  <script src="{% static 'falcon2/public/vendors/swiper/swiper-bundle.min.js'%}"></script>
  <link rel="stylesheet" href="{% static 'css/venue_details.css' %}">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="https://cdn.rawgit.com/harvesthq/chosen/gh-pages/chosen.jquery.min.js"></script>
  <link href="https://cdn.rawgit.com/harvesthq/chosen/gh-pages/chosen.min.css" rel="stylesheet"/>

{% endblock link %}


{% block title %}
      <title>{{event.name}}</title>
{% endblock title %}


{% block content %}

{% if form.errors %}
    {% for field in form %}
        {% for error in field.errors %}
            <div class="alert alert-danger">
                <strong>{{ error|escape }}</strong>
            </div>
        {% endfor %}
    {% endfor %}
    {% for error in form.non_field_errors %}
        <div class="alert alert-danger">
            <strong>{{ error|escape }}</strong>
        </div>
    {% endfor %}
{% endif %}

    <!-- ===============================================-->
    <!--    Main Content-->
    <!-- ===============================================-->
    <main class="main" id="top">
      <div class="container" data-layout="container">
        <script>
          var isFluid = JSON.parse(localStorage.getItem('isFluid'));
          if (isFluid) {
            var container = document.querySelector('[data-layout]');
            container.classList.remove('container');
            container.classList.add('container-fluid');
          }
        </script>
       
          <div class="row">
            <div class="col-12">
              <div class="card mb-3 btn-reveal-trigger">
                <div class="card-header position-relative min-vh-25 mb-8">
                  <div class="cover-image">
                    <div class="bg-holder rounded-3 rounded-bottom-0" style="background-image:url({% static 'event_background.jpg' %});">
                    </div>
                    <!--/.bg-holder-->

                    <input class="d-none" id="upload-cover-image" type="file" />
                    <label class="cover-image-file-input" for="upload-cover-image"><span class="fas fa-camera me-2"></span><span>Change cover photo</span></label>
                  </div>
                  <div class="avatar avatar-5xl avatar-profile shadow-sm img-thumbnail rounded-circle">
                    <div class="h-100 w-100 rounded-circle overflow-hidden position-relative"> 
                      {% if event.venue|get_image %}
                        <img src={{ event.venue|get_image }} width="200" alt="" data-dz-thumbnail="data-dz-thumbnail" />
                      {% else %}
                        <img src={% static 'event_bg.jpeg' %} width="200" alt="" data-dz-thumbnail="data-dz-thumbnail" />
                      {% endif %}
                      <input class="d-none" id="profile-image" type="file" />
                      <label class="mb-0 overlay-icon d-flex flex-center" for="profile-image"><span class="bg-holder overlay overlay-0"></span><span class="z-index-1 text-white dark__text-white text-center fs--1"><span class="fas fa-camera"></span><span class="d-block">Edit</span></span></label>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="row g-0">
            <div class="col-lg-8 pe-lg-2">
              <div class="card mb-3">
                <div class="block d-flex justify-content-between align-items-center">
                  <div class="card-header">
                    <h5 class="mb-0">Event Settings</h5>
                  </div>
              </div>
                <div class="card-body bg-light">
                  <form class="row g-3">
                    
                    <div class="col-lg-6" style="align-items: center" >
                            <label class="form-label" for="name">Name </label>
                        <p>{{ event.name }}</p>
                    </div>
                    <div class="col-lg-6">
                      <label class="form-label" for="date">Date</label>
                      <p>{{ event.date }}</p>
                    </div>
                    <div class="col-lg-6">
                      <label class="form-label" >Opening</label>
                        <p>{{event.opening}}</p>
                    </div>
                    <div class="col-lg-6">
                        <label class="form-label" >Closing</label>
                          <p>{{event.closing}}</p>
                      </div>
                    <div class="col-lg-6">
                        <label class="form-label" for="phone">Venue</label>
                        <p><a href="{% url 'get_venue_details' event.venue.id %}">{{ event.venue.name }}</a></p>
                    </div>
                    
                    {% if is_allowed_to_change %}
                    <div  class="button-edit-delete d-flex justify-content-between">                    
                        <a class="btn btn-danger" href="{% url 'delete_event' event.id %}" type="submit">Delete </a>
                        <a class="btn btn-primary" href="{% url 'update_event' event.id %}" type="submit">Edit </a>
                    </div>

                    {% endif %}
                  </form>
                </div>
              </div>
              {% if users_in_team %}          
                <div class="card mb-3">
                  <div class="card-header">
                    <h5 class="mb-0">Users in a team</h5>
                  </div>
                  <div class="card-body bg-light">
                    <table class="table table-bordered">
                      <thead>
                        <tr>
                          <th  scope="col">User</th>
                          <th  scope="col">Role</th>
                          <th class="text-center">Action</th>
                          <th class="text-center">Delete</th>
                        </tr>
                      </thead>
                      <tbody>
                        {% for user_for in users_in_team %}

                          <tr style="align-items:center">
                            <td >{{user_for.user.email}}</td>
                            <td ><input class="form-control" style="width:100px" id="{{user_for.id}}" name="{{user_for.user.email}}" type="text" value="{{user_for.role}}"></td>
                           
                            <td>

                              <div class="my-box text-center" id="userChange" name={{user_for.id}} style="width:100%">
                                <a class="btn btn-info" name={{user_for.id}} href="#popup1">Change</a>
                              </div>
                              
                            </td>
                            <td><div class="my-box text-center" style="width:100%">
                              
                              <a href="{% url 'delete_user_from_team' event.id user_for.user.email %}" class="btn btn-danger">Delete</a>
                            </div></td>
                          </tr>
                          
                        {% endfor %}
                      </tbody>
                    </table>
                  </div>

                </div>

              {% endif %}  
              
              
            </div>
            <div class="col-lg-4 ps-lg-2">
            <div class="col-lg-12 ps-lg-2">
              <div class="sticky-sidebar">
                <div class="card mb-3 overflow-hidden">
                  <div class="card-header">
                    <h5 class="mb-0">Team Users</h5>
                  </div>

                  <form class="form_add_user" method="POST" action="{% url 'add_user_to_team' event.id %}" style="height:180px; align-items:center; padding:20px" >
                    {% csrf_token %}
                    <select class="form-control mb-2" name="users_for_adding" id="users_for_adding">
                      <option value="">--Please choose an option--</option>
                      {% for us in aval_users %}
                            <option value="{{us.email}}">{{us.email}}</option>
                      {% endfor %}
                      
                    </select>

                    <div class="col-lg-12 " >
                      <input class="form-control" placeholder="Role...." name="users_for_adding_role" id="users_for_adding_role" type="text">
                    </div>

                    <div class="block_add_user" style="display: flex; justify-content:space-between; margin-top: 10px;">
                      <div></div>
                      <button type="submit" class='btn btn-primary' >ADD</button>
                    </div>
                  </form>
                
              </div>
            </div>
            
            <div class="col-lg-4 ps-lg-2" style="width: 104%; margin-left: -4%;">
              <div class="col-lg-12 ps-lg-2">
                <div class="sticky-sidebar">
                  <div class="card mb-3 overflow-hidden">
                    <div class="card-header" style="display: flex; justify-content: space-between; align-items:center">
                      <h5 class="mb-0">Rental Products</h5>
                      <a class="btn btn-success" href="{% url 'get_event_products_list' event.id %}">All Products</a>
                    </div>
  
                    <form class="form_add_user" enctype="multipart/form-data" method="POST" action="{% url 'add_event_product' event.id %}" style="height:220px; align-items:center; padding:20px" >
                      {% csrf_token %}
                      {% comment %} <input placeholder="Name" type="text" name="product_name" id="" style="margin-top: -10px;" class=" mb-2 form-control"> {% endcomment %}
                      {% comment %} {{form.file_field|add_class:'form-control'}} {% endcomment %}
                      <div class="col-lg-12 mb-2"  >
                        {{form_event.name|add_class:'form-control'}}
                        <div class="form-error" style="color: red;">
                          {{ form_event.name.errors }}
                        </div>
                      </div>
                      <div class="col-lg-12" >
                        {{form_event.picture|add_class:'form-control'}}
                        <div class="form-error" style="color: red;">
                          {{ form_event.picture.errors }}
                        </div>
                      </div>
                      
                      <div class="block mb-3" style="margin-top: 8px; width:100%; display: flex; justify-content:space-between">  
                        <div class="col-lg-5" >
                          {{form_event.price|add_class:'form-control'}}
                          <div class="form-error" style="color: red;">
                            {{ form_event.price.errors }}
                          </div>
                        </div>
                        <div class="col-lg-5" >
                          {{form_event.count|add_class:'form-control'}}
                          <div class="form-error" style="color: red;">
                            {{ form_event.count.errors }}
                          </div>
                        </div>
                      </div> 

                      <div class="block_add_user" style="display: flex; justify-content:space-between; margin-top: 10px;">
                        <div></div>
                        <button type="submit" class='btn btn-primary' >ADD</button>
                      </div>
                    </form>
                  
                </div>
              </div>
          
        </div>
        
      </div>
    </main>
    <!-- ===============================================-->
    <!--    End of Main Content-->
    <!-- ===============================================-->


  
    <script type="text/javascript">
      // add user to ones who can change
      var  eventId = "{{ event.id }}"
      var myForm = document.querySelector(".add_artist_to_event")
      if(myForm){
        myForm.onsubmit = (e) =>{
          e.preventDefault()
          var addedArtistId = document.getElementById("artist_for_adding").value
        }
      }
      

       // change user permissions
      var changeButtons = document.querySelectorAll("#userChange")
      if (changeButtons){
        for(var i=0; i<changeButtons.length; i++){
          changeButtons[i].onclick = (e) =>{
            var role = document.getElementById(e.target.name).value
            var userEmail = document.getElementById(e.target.name).name
            var url = "{% url 'edit_user_in_team' %}"
            document.location.href = url + eventId + "/" + userEmail + '/' + role + '/'
            }
        } 
      }

      var reponsibilities = document.getElementById("id_customers_responsibility")
      reponsibilities.style.cssText = `
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap
      `


    </script>


{% endblock %}
